<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard - <%= student.NAME %></title>
    <link rel="icon" type="image/png" href="/attend.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .student-header {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 1rem;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #007bff;
        }
        
        .attendance-badge {
            font-size: 1.2rem;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }
        
        .qr-container {
            background: white;
            border-radius: 10px;
            padding: 2rem;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-tabs .nav-link {
            border-radius: 10px 10px 0 0;
            margin-right: 0.5rem;
        }
        
        .nav-tabs .nav-link.active {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }
        
        .tab-content {
            background: white;
            border-radius: 0 10px 10px 10px;
            padding: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <!-- Student Header -->
        <div class="student-header">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h2><i class="fas fa-user-graduate"></i> <%= student.NAME %></h2>
                    <p class="mb-1"><strong>Roll Number:</strong> <%= student.ROLLNO %></p>
                    <p class="mb-1"><strong>Email:</strong> <%= student.EMAIL %></p>
                    <p class="mb-0"><strong>Class:</strong> <%= classDetail.CLASSNAME %> - <%= classDetail.SUBJECT %></p>
                </div>
                <div class="col-md-4 text-end">
                    <div class="attendance-badge badge bg-<%= attendancePercentage >= 75 ? 'success' : attendancePercentage >= 60 ? 'warning' : 'danger' %>">
                        <%= attendancePercentage %>% Attendance
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Stats Cards -->
        <div class="row mb-4">
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number text-success"><%= presentDays %></div>
                    <div>Present Days</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number text-danger"><%= totalDays - presentDays %></div>
                    <div>Absent Days</div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="stat-card">
                    <div class="stat-number text-info"><%= totalDays %></div>
                    <div>Total Classes</div>
                </div>
            </div>
        </div>
        
        <!-- Tabs -->
        <ul class="nav nav-tabs" id="studentTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="attendance-tab" data-bs-toggle="tab" data-bs-target="#attendance" type="button" role="tab">
                    <i class="fas fa-calendar-check"></i> Attendance History
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="qrcode-tab" data-bs-toggle="tab" data-bs-target="#qrcode" type="button" role="tab">
                    <i class="fas fa-qrcode"></i> My QR Code
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="report-tab" data-bs-toggle="tab" data-bs-target="#report" type="button" role="tab">
                    <i class="fas fa-chart-bar"></i> View Report
                </button>
            </li>
        </ul>
        
        <div class="tab-content" id="studentTabsContent">
            <!-- Attendance History Tab -->
            <div class="tab-pane fade show active" id="attendance" role="tabpanel">
                <h5><i class="fas fa-history"></i> Recent Attendance</h5>
                <% if (attendanceHistory && attendanceHistory.length > 0) { %>
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% attendanceHistory.slice(0, 10).forEach(function(record) { %>
                                    <tr>
                                        <td><%= new Date(record.date).toLocaleDateString() %></td>
                                        <td>
                                            <span class="badge bg-<%= record.status === 'present' ? 'success' : 'danger' %>">
                                                <%= record.status.charAt(0).toUpperCase() + record.status.slice(1) %>
                                            </span>
                                        </td>
                                    </tr>
                                <% }); %>
                            </tbody>
                        </table>
                    </div>
                <% } else { %>
                    <div class="text-center text-muted">
                        <i class="fas fa-calendar-times fa-3x mb-3"></i>
                        <p>No attendance records found.</p>
                    </div>
                <% } %>
            </div>
            
            <!-- QR Code Tab -->
            <div class="tab-pane fade" id="qrcode" role="tabpanel">
                <div class="qr-container">
                    <h5><i class="fas fa-qrcode"></i> My QR Code</h5>
                    <p class="text-muted">Show this QR code to mark your attendance</p>
                    <% if (qrCode) { %>
                        <img src="<%= qrCode %>" alt="Student QR Code" class="img-fluid" style="max-width: 200px;">
                        <div class="mt-3">
                            <small class="text-muted">Roll Number: <%= student.ROLLNO %></small>
                        </div>
                    <% } else { %>
                        <p class="text-danger">QR Code not available</p>
                    <% } %>
                </div>
            </div>
            
            <!-- Report Tab -->
            <div class="tab-pane fade" id="report" role="tabpanel">
                <div class="text-center">
                    <h5><i class="fas fa-chart-bar"></i> Attendance Report</h5>
                    <p class="text-muted">View your detailed attendance report</p>
                    
                    <div class="d-grid gap-2 d-md-block">
                        <a href="/student-attendance-report/<%= student.ROLLNO %>" class="btn btn-primary" target="_blank">
                            <i class="fas fa-file-alt"></i> View Detailed Report
                        </a>
                        <a href="/student-attendance-summary?rollno=<%= student.ROLLNO %>" class="btn btn-outline-primary" target="_blank">
                            <i class="fas fa-table"></i> View Summary
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Back Button -->
        <div class="text-center mt-4">
            <a href="/student-portal" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left"></i> Back to Student Portal
            </a>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
